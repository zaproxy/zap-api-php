# PHP Client API For OWASP ZAP

This API is available on [Packagist](https://packagist.org/packages/zaproxy/api-client).

## Getting Started

```bash
composer require zaproxy/api-client
```

## Usage

Example:

```php
<?php

require "vendor/autoload.php";

$target = "http://target.example.com/";

$zap = new Zap\Zap('tcp://localhost:8090');

$version = $zap->core->version();
if (is_null($version)) {
  echo "PHP API error\n";
  exit();
} else {
  echo "version: ${version}\n";
}

echo "Spidering target ${target}\n";
// Give the Spider a chance to start
$res = $zap->spider->scan($target, 'YOUR_IP_KEY');
if (isset($res->code)) {
    echo "Error:\n";
    echo "  code = $res->code\n";
    echo "  message = $res->message ?? ''\n";
    exit();
}
while ($zap->spider->status() < 100) {
  echo "Spider progress {$zap->spider->status()}%\n";
  sleep(2);
}
echo "Spider completed\n";
// Give the passive scanner a chance to finish
sleep(5);

echo "Scanning target ${target}\n";
$res = $zap->ascan->scan($target, 0, 0, 'YOUR_IP_KEY');
if (isset($res->code)) {
    echo "Error:\n";
    echo "  code = $res->code\n";
    echo "  message = $res->message\n";
    exit();
}
while ($zap->ascan->status() < 100) {
  echo "Scan progress {$zap->ascan->status()}%\n";
  sleep(2);
}
echo "Scan completed\n";

// Report the results
echo "Hosts: " . implode(",", $zap->core->hosts()) . "\n";
$alerts = $zap->core->alerts($target, "", "");
echo "Alerts (" . count($alerts) . "):\n";
print_r($alerts);

```

## API

OWASP ZAP API docs: [API Details](https://www.zaproxy.org/docs/api/)

## Contributing

### Code generation

API elements can be generated by cloning the [zaproxy](https://github.com/zaproxy/zaproxy) and [zap-extensions](https://github.com/zaproxy/zap-extensions) repositories at the same level as this repository and then run

```bash
composer generate
```

However if we need to test changes in [the generator class](https://github.com/zaproxy/zaproxy/blob/main/zap/src/main/java/org/zaproxy/zap/extension/api/PhpAPIGenerator.java) we can run:

```bash
cd zaproxy
git fetch origin -t
git checkout tags/v2.11.1
./gradlew generatePhpApiEndpoints
cd -

cd zap-extensions
# Remove `-Werror` from the compilerArgs in build.gradle.kts
# In the class LegacyConnectionParam remove the annotations of setProxyChainSkipName and remove the super call.
ZAP_RELEASE=1 ZAP_JAVA_VERSION=11 ./gradlew --include-build ../zaproxy :aO:network:generatePhpZapApiClientFiles --continue
cd -
```

**Note:** This library is based on the elements generated form the main zaproxy repository like every other language library in zaproxy environment. While lack of typing might be inconvenient it is better to be consistent.
